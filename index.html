<!DOCTYPE html>
<meta charset="utf-8" />
<script src="//d3js.org/d3.v4.min.js" charset="utf-8"></script>
<script
  src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.1/lodash.min.js"
  charset="utf-8"
></script>
<link rel="shortcut icon" href="/favicon.ico" />

<html>
  <style>
    #grid {
      row-gap: 100px;
    }
  </style>
  <head> </head>
  <body>
    <div class="container">
      <div id="grid"></div>
      <div id="words"></div>
    </div>
  </body>
  <script src="js/loadData.js"></script>
  <script>
    //*********************************************************
    d3.queue()
      .defer(d3.csv, "data/colors.csv")
      .defer(d3.csv, "data/languages.csv")
      .defer(d3.csv, "data/language_term_dict.csv")
      .defer(d3.csv, "data/chip_term_dict.csv")
      .defer(d3.csv, "data/speakers.csv")
      .await(
        (error, mycolor, languages, langTermDict, chipTermDict, speakers) => {
          // console.log("my color is");
          // console.log(mycolor);
          // console.log("languages");
          // console.log(languages);
          // console.log("lang term dict");
          // console.log(langTermDict);
          // console.log("chip term dict");
          // console.log(chipTermDict);
          // console.log("speakers");
          // console.log(speakers);

          let termAbbrevTermDict = getTermAbbrevToTermDict(langTermDict);
          // console.log("term abbrev term dict");
          // console.log(termAbbrevTermDict);

          var color = mycolor[Math.floor(Math.random() * 330)];
          var colorData = getDataByColor(
            color["L*"],
            color["a*"],
            color["b*"],
            mycolor,
            chipTermDict,
            termAbbrevTermDict
          );
          console.log("color data for given chip ID is");
          console.log(colorData);

          var gridData = getGridData(mycolor);
          // I like to log the data to the console for quick debugging
          console.log("grid data");
          console.log(gridData);

          var tooltip = d3.select("#words").append("div").style("opacity", 0);
          // .attr("class", "tooltip");

          let mouseOver = function (d) {
            console.log(d.color.a);
            var terms = getDataByColor(
              d.color.l,
              d.color.a,
              d.color.b,
              mycolor,
              chipTermDict,
              termAbbrevTermDict
            );

            console.log(terms);

            // tooltip.style("opacity", 1);
            d3.select("#words")
              // .style("stroke", "black")
              // .style("opacity", 1)
              .html(JSON.stringify(terms));
          };

          let mouseLeave = function (d) {
            // d3.selectAll(".Country")
            //   .transition()
            //   .duration(200)
            //   .style("opacity", 0.8);
            // d3.select(this)
            //   .transition()
            //   .duration(200)
            //   .style("stroke", "transparent");
          };

          var grid = d3
            .select("#grid")
            .append("svg")
            .attr("width", "1000px")
            .attr("height", "510px");
          // .call(
          //   d3.zoom().on("zoom", function () {
          //     svg.attr("transform", d3.event.transform);
          //   })
          // );

          var row = grid
            .selectAll(".row")
            .data(gridData)
            .enter()
            .append("g")
            .attr("class", "row");

          var column = row
            .selectAll(".square")
            .data(function (d) {
              return d;
            })
            .enter()
            .append("rect")
            .attr("class", "square")
            .attr("x", function (d) {
              return d.x;
            })
            .attr("y", function (d) {
              return d.y;
            })
            .attr("width", function (d) {
              return d.width;
            })
            .attr("height", function (d) {
              return d.height;
            })
            .attr("padding", function (d) {
              return "10px";
            })
            .style("fill", function (d) {
              return d.color;
            }) //"#fff")
            .style("stroke", "#222")
            .on("mouseover", mouseOver)
            .on("click", function (d) {
              d.click++;
              if (d.click % 4 == 0) {
                d3.select(this).style("fill", "#fff");
              }
              if (d.click % 4 == 1) {
                d3.select(this).style("fill", "#2C93E8");
              }
              if (d.click % 4 == 2) {
                d3.select(this).style("fill", "#F56C4E");
              }
              if (d.click % 4 == 3) {
                d3.select(this).style("fill", "#838690");
              }
            });
        }
      );

    //***********************************************************
    // d3.csv("colors.csv", d3.autoType)
    //   .then(async function (data) {
    // d3.csv("colors.csv", function (data) {
    //   console.log(data);
    //   //   var yellow = d3.hcg(10.0, 0, 9.5);
    //   //   console.log(yellow);

    //   function gridDataFunc(data) {
    //     // console.log("starting data", data.length);
    //     var color_data = new Array();
    //     var xpos = 1; //starting xpos and ypos at 1 so the stroke will show when we make the grid below
    //     var ypos = 1;

    //     // for (var cell = 0; cell < 10 * 10; cell++) {
    //     //   color_data.push({
    //     //     // id: cell,
    //     //     // color: "#" + Math.floor(Math.random() * 16777215).toString(16),
    //     //     color: d3.hcg(10.0, 0, 9.5),
    //     //   });
    //     // }

    //     for (var cell = 0; cell < data.length; cell++) {
    //       // console.log(data[cell]);
    //       // console.log(data[cell]["#cnum"]);
    //       // console.log(
    //       //   d3.lab(
    //       //     parseFloat(data[cell]["L*"]),
    //       //     parseFloat(data[cell]["a*"]),
    //       //     parseFloat(data[cell]["b*"]),
    //       //     (opacity = 1)
    //       //   )
    //       // );

    //       color_data.push({
    //         // id: data[cell]["#cnum"],
    //         id: cell,
    //         color: [
    //           d3.lab(
    //             parseFloat(data[cell]["L*"]),
    //             parseFloat(data[cell]["a*"]),
    //             parseFloat(data[cell]["b*"])
    //           ),
    //         ],
    //       });
    //     }
    //     console.log("hello");
    //     console.log(color_data);
    //     return color_data;
    //   }

    //   var width = 50;
    //   var height = 50;

    //   var gridData = gridDataFunc(data);
    //   console.log("grid data");
    //   console.log(gridData);

    //   var grid = d3
    //     .select("#grid")
    //     .append("svg")
    //     .attr("width", "510px")
    //     .attr("height", "510px");

    //   function update() {
    //     console.log("beg of update");
    //     for (var i = 0; i < gridData.length; i++) {
    //       var cell = gridData[i];
    //       console.log("cell", cell);
    //       //   cell.color = "#" + Math.floor(Math.random() * 16777215).toString(16);
    //       cell.color = [
    //         d3.lab(
    //           parseFloat(gridData[i]["L*"]),
    //           parseFloat(gridData[i]["a*"]),
    //           parseFloat(gridData[i]["b*"])
    //         ),
    //       ];
    //     }

    //     var cell = grid.selectAll(".cell").data(gridData);

    //     cell
    //       .enter()
    //       .append("rect")
    //       .attr("class", "cell")
    //       .attr("x", function (d) {
    //         return (d.id % 10) * width;
    //       })
    //       .attr("y", function (d) {
    //         return Math.floor(d.id / 10) * height;
    //       })
    //       .attr("width", width)
    //       .attr("height", height)
    //       .style("fill", function (d) {
    //         console.log("color");
    //         console.log(d.color);
    //         return d.color;
    //       })
    //       .style("stroke", "#222");

    //     cell
    //       .transition()
    //       .duration(1500)
    //       .delay(1500)
    //       .style("fill", function (d) {
    //         return d.color;
    //       });
    //   }

    //   console.log("when are we gtting here");
    //   setInterval(update, 5000);

    //**************************************************************************
    //   var square = 20,
    //     w = 900,
    //     h = 300;

    //   // create the svg
    //   var svg = d3.select("#grid").append("svg").attr({
    //     width: w,
    //     height: h,
    //   });

    //   // calculate number of rows and columns
    //   var squaresRow = _.round(w / square);
    //   var squaresColumn = _.round(h / square);

    //   // loop over number of columns
    //   _.times(squaresColumn, function (n) {
    //     // create each set of rows
    //     var rows = svg
    //       .selectAll("rect" + " .row-" + (n + 1))
    //       .data(d3.range(squaresRow))
    //       .enter()
    //       .append("rect")
    //       .attr({
    //         class: function (d, i) {
    //           return "square row-" + (n + 1) + " " + "col-" + (i + 1);
    //         },
    //         id: function (d, i) {
    //           return "s-" + (n + 1) + (i + 1);
    //         },
    //         width: square,
    //         height: square,
    //         x: function (d, i) {
    //           return i * square;
    //         },
    //         y: n * square,
    //         fill: d3.hcl(10.0, 0, 9.5), //"#fff",
    //         stroke: "#FDBB30",
    //       });

    //     // test with some feedback
    //     var test = rows.on("mouseover", function (d, i) {
    //       d3.select("#grid-ref").text(function () {
    //         return "row: " + (n + 1) + " | " + "column: " + (i + 1);
    //       });
    //       d3.selectAll(".square").attr("fill", "white");
    //       d3.select(this).attr("fill", d3.lab(51.57, 35.21, -24.66)); //"#7AC143"
    //     });
    //   });
    //*****************************************************************
    //   var width = 500,
    //     height = 500;

    //   var x = d3.scaleOrdinal().range([20, 200], 0.1);
    //   var y = d3.scaleOrdinal().range([500, 20], 0.1);

    //   var svg = d3
    //     .select("#chart")
    //     .append("svg")
    //     .attr("width", width)
    //     .attr("height", height);

    //   var hue = 0;
    //   var data_color = createData(hue);
    //   console.log("new data");
    //   console.log(data);

    //   svg.call(renderCircles, data_color);

    //   function renderCircles(selection, data) {
    //     var circles = selection.selectAll("circle").data(data);
    //     console.log("new data");
    //     console.log(data);

    //     circles
    //       .enter()
    //       .append("circle")
    //       .attr("cx", function (d) {
    //         return x(d[1]);
    //       })
    //       .attr("cy", function (d) {
    //         return y(d[2]);
    //       })
    //       .attr("r", 20)
    //       .attr("transform", "translate(" + 5 + "," + 5 + ")");

    //     circles.attr("fill", function (d) {
    //       return d3.hcl(d[0], d[1], d[2]).toString();
    //     });
    //   }

    //   function createData(h) {
    //     return d3
    //       .range(-125, 150, 25)
    //       .map(function (c) {
    //         return d3.range(0, 100, 10).map(function (l) {
    //           return [h, c, l];
    //         });
    //       })
    //       .reduce(function (a, b) {
    //         return a.concat(b);
    //       });
    //   }
    // });
    // .catch((e) => {
    //   console.log(e);
    // });
  </script>
</html>
