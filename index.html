<!DOCTYPE html>
<meta charset="utf-8" />
<script src="//d3js.org/d3.v4.min.js" charset="utf-8"></script>
<script
  src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.1/lodash.min.js"
  charset="utf-8"
></script>
<script src="https://cdn.jsdelivr.net/gh/holtzy/D3-graph-gallery@master/LIB/d3.layout.cloud.js"></script>
<link rel="shortcut icon" href="/favicon.ico" />

<html>
  <style type="text/css">
    @font-face {
      font-family: "Twentieth Century Medium";
      src: url("/fonts/TwentiethCenturyforKenmoreMedium.ttf") format("truetype");
    }
    @font-face {
      font-family: "Twentieth Century Semi Bold";
      src: url("/fonts/TwentiethCenturyforKenmoreSemibold.ttf")
        format("truetype");
    }
    @font-face {
      font-family: "Twentieth Century Light";
      src: url("/fonts/TwentiethCenturyforKenmoreLight.ttf") format("truetype");
    }
    @font-face {
      font-family: "Twentieth Century Bold";
      src: url("/fonts/TwentiethCenturyforKenmoreBold.ttf") format("truetype");
    }
    p.customfont {
      font-family: "Twentieth Century Medium", "Twentieth Century Semi Bold",
        "Twentieth Century Light", "Twentieth Century Bold";
    }
  </style>

  <style>
    .wcs-title {
      margin: 0;
      padding: 0px;
      text-align: center;
      position: sticky;
    }

    .subtitle {
      margin: 0;
      padding: 0px;
      text-align: center;
    }

    .line-break {
      background: #ececec;
      width: 1000px;
      height: 3px;
      margin: 3em auto;
    }

    #grid {
      row-gap: 100px;
    }

    #words {
      font-family: "Twentieth Century Light";
    }

    footer {
      font-family: "Twentieth Century Light";
      padding: 50px;
    }
  </style>
  <head> </head>
  <body>
    <div class="wcs-title">
      <div class="container text-left">
        <div class="row">
          <div class="col-sm-1" style="padding: 0px; margin-bottom: -30px">
            <img src="images/world_globe.png" alt="logo" class="world-logo" />
          </div>
          <div class="col-sm-11" style="padding: 0px">
            <h1
              style="font-family: 'Twentieth Century Medium'; font-size: 48px"
            >
              World <span style="color: #95e1d3">C</span
              ><span style="color: #8ac4d0">o</span
              ><span style="color: #fce38a">l</span
              ><span style="color: #ff75a0">o</span
              ><span style="color: #845ec2">r</span> Survey
            </h1>
          </div>
        </div>
      </div>
    </div>

    <div class="subtitle">
      <div class="container text-left">
        <div class="row">
          <div class="col-sm-11" style="padding: 0px">
            <h2 style="font-family: 'Twentieth Century Light'; font-size: 24px">
              110 UNWRITTEN LANGUAGES, EACH 24 NATIVE SPEAKERS
            </h2>
          </div>
          <div class="row" style="padding: 0px">
            <p style="font-family: 'Twentieth Century Light'; font-size: 16px">
              WCS was initiated in the late 1970s to investigate how native
              speakers around the world classify colors. Within each unwritten
              language, native speakers were asked to name each of the 330
              Munsell chips randomly.
            </p>
          </div>
          <div class="row">
            <div class="line-break"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="container">
      <p
        style="
          text-align: center;
          color: grey;
          font-family: 'Twentieth Century Light';
        "
      >
        Scroll over a color to see the word cloud update!
      </p>
      <div style="text-align: center" id="grid"></div>
      <div style="text-align: center" id="words"></div>
    </div>

    <footer class="container-fluid text-center">
      <div class="row">
        <div class="line-break"></div>
      </div>
      <div class="row">
        <div class="col-sm-12">
          <h4
            style="
              font-family: 'Twentieth Century Light';
              font-size: 24px;
              margin-bottom: 0px;
            "
          >
            SUPPORT
          </h4>
        </div>
      </div>

      <div class="row">
        <div class="col-sm-4">
          <a href="https://www.kaggle.com/jboysen/color-survey?select=dict.txt "
            >Dataset</a
          >
        </div>
        <div class="col-sm-4">
          <a href="https://www.cufonfonts.com/font/twentieth-century">Fonts</a>
        </div>
        <div class="col-sm-4">
          <a
            href="https://github.com/d3/d3-scale-chromatic/blob/master/README.md"
            >Color Grid Link TBD</a
          >
        </div>
        <div class="col-sm-4">
          <a href="https://www.jing.fm/iclipt/xbioo/">Logo</a>
        </div>
      </div>
    </footer>
  </body>
  <script src="js/loadData.js"></script>
  <script>
    //*********************************************************
    d3.queue()
      .defer(d3.csv, "data/colors.csv")
      .defer(d3.csv, "data/languages.csv")
      .defer(d3.csv, "data/language_term_dict.csv")
      .defer(d3.csv, "data/chip_term_dict.csv")
      .defer(d3.csv, "data/speakers.csv")
      .await(
        (error, mycolor, languages, langTermDict, chipTermDict, speakers) => {
          let termAbbrevTermDict = getTermAbbrevToTermDict(langTermDict);

          var color = mycolor[Math.floor(Math.random() * 330)];
          var colorData = getDataByColor(
            color["L*"],
            color["a*"],
            color["b*"],
            mycolor,
            chipTermDict,
            termAbbrevTermDict
          );
          console.log("color data for given chip ID is");
          console.log(colorData);

          var gridData = getGridData(mycolor);
          console.log("grid data");
          console.log(gridData);

          // var tooltip = d3.select("#words").append("div").style("opacity", 0);
          // .attr("class", "tooltip");

          let mouseOver = function (d) {
            var terms = getDataByColor(
              d.color.l,
              d.color.a,
              d.color.b,
              mycolor,
              chipTermDict,
              termAbbrevTermDict
            );

            var updatedWords = getListofTerms(terms.all_terms);

            // updateWordMap(colorWords);
            updateWordMap(updatedWords);

            // tooltip.style("opacity", 1);

            // .style("stroke", "black")
            // .style("opacity", 1)
            // .html(JSON.stringify(terms));
          };

          let mouseLeave = function (d) {
            var terms = getDataByColor(
              d.color.l,
              d.color.a,
              d.color.b,
              mycolor,
              chipTermDict,
              termAbbrevTermDict
            );

            var updatedWords = getListofTerms(terms.all_terms);

            // updateWordMap(colorWords);
            updateWordMap([]);

            // updateWordMap([]);
            // d3.selectAll(".Country")
            //   .transition()
            //   .duration(200)
            //   .style("opacity", 0.8);
            // d3.select(this)
            //   .transition()
            //   .duration(200)
            //   .style("stroke", "transparent");
          };

          var grid = d3
            .select("#grid")
            .append("svg")
            .attr("width", "1000px")
            .attr("height", "300px");
          // .call(
          //   d3.zoom().on("zoom", function () {
          //     svg.attr("transform", d3.event.transform);
          //   })
          // );

          var row = grid
            .selectAll(".row")
            .data(gridData)
            .enter()
            .append("g")
            .attr("class", "row");

          var column = row
            .selectAll(".square")
            .data(function (d) {
              return d;
            })
            .enter()
            .append("rect")
            .attr("class", "square")
            .attr("x", function (d) {
              return d.x;
            })
            .attr("y", function (d) {
              return d.y;
            })
            .attr("width", function (d) {
              return d.width;
            })
            .attr("height", function (d) {
              return d.height;
            })
            .attr("padding", function (d) {
              return "10px";
            })
            .style("fill", function (d) {
              return d.color;
            }) //"#fff")
            .style("stroke", "#222")
            .on("mouseover", mouseOver)
            .on("mouseout", mouseLeave)
            .on("click", function (d) {
              d.click++;
              if (d.click % 4 == 0) {
                d3.select(this).style("fill", "#fff");
              }
              if (d.click % 4 == 1) {
                d3.select(this).style("fill", "#2C93E8");
              }
              if (d.click % 4 == 2) {
                d3.select(this).style("fill", "#F56C4E");
              }
              if (d.click % 4 == 3) {
                d3.select(this).style("fill", "#838690");
              }
            });

          var word_cloud = d3
            .select("#words")
            .append("svg")
            .attr("width", "1000px")
            .attr("height", "510px");

          var width = 1000;
          var height = 510;

          var first_terms = getDataByColor(
            gridData[0][0].color.l,
            gridData[0][0].color.a,
            gridData[0][0].color.b,
            mycolor,
            chipTermDict,
            termAbbrevTermDict
          ).all_terms;

          var colorWords = getListofTerms(first_terms);

          var layout = d3.layout
            .cloud()
            .size([width, height])
            .words(
              colorWords.map(function (d) {
                return {
                  text: d,
                  // size: Math.random() * 100,
                };
              })
            )
            .padding(5)
            .fontSize(20)
            // .font("Twentieth Century Light")
            .on("end", draw);
          layout.start();

          function draw(words) {
            word_cloud
              .append("g")
              .attr(
                "transform",
                "translate(" +
                  layout.size()[0] / 2 +
                  "," +
                  layout.size()[1] / 2 +
                  ")"
              )
              .selectAll("text")
              .data(words)
              .enter()
              .append("text")
              .style("font-size", function (d) {
                return d.size + "px";
              })
              .attr("text-anchor", "middle")
              .attr("transform", function (d) {
                return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
              })
              .text(function (d) {
                return d.text;
              });
          }

          function updateWordMap(colorWords) {
            console.log("colorwords in update", colorWords);
            layout
              .size([width, height])
              .words(
                colorWords.map(function (d) {
                  return {
                    text: d,
                    // size: Math.random() * 100,
                  };
                })
              )
              .padding(5)
              .fontSize(20)
              // .font("helvetica")
              .on("end", updateCloud);
            layout.start();
          }

          function updateCloud(colorWords) {
            word_cloud.selectAll("text").remove();
            word_cloud
              .append("g")
              .attr(
                "transform",
                "translate(" +
                  layout.size()[0] / 2 +
                  "," +
                  layout.size()[1] / 2 +
                  ")"
              )
              .selectAll("text")
              .data(colorWords)
              .enter()
              .append("text")
              .transition()
              .duration(50)
              .style("font-size", function (d) {
                return d.size + "px";
              })
              .attr("text-anchor", "middle")
              .attr("transform", function (d) {
                return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
              })
              .text(function (d) {
                return d.text;
              });
          }
        }
      );

    //***********************************************************
    // d3.csv("colors.csv", d3.autoType)
    //   .then(async function (data) {
    // d3.csv("colors.csv", function (data) {
    //   console.log(data);
    //   //   var yellow = d3.hcg(10.0, 0, 9.5);
    //   //   console.log(yellow);

    //   function gridDataFunc(data) {
    //     // console.log("starting data", data.length);
    //     var color_data = new Array();
    //     var xpos = 1; //starting xpos and ypos at 1 so the stroke will show when we make the grid below
    //     var ypos = 1;

    //     // for (var cell = 0; cell < 10 * 10; cell++) {
    //     //   color_data.push({
    //     //     // id: cell,
    //     //     // color: "#" + Math.floor(Math.random() * 16777215).toString(16),
    //     //     color: d3.hcg(10.0, 0, 9.5),
    //     //   });
    //     // }

    //     for (var cell = 0; cell < data.length; cell++) {
    //       // console.log(data[cell]);
    //       // console.log(data[cell]["#cnum"]);
    //       // console.log(
    //       //   d3.lab(
    //       //     parseFloat(data[cell]["L*"]),
    //       //     parseFloat(data[cell]["a*"]),
    //       //     parseFloat(data[cell]["b*"]),
    //       //     (opacity = 1)
    //       //   )
    //       // );

    //       color_data.push({
    //         // id: data[cell]["#cnum"],
    //         id: cell,
    //         color: [
    //           d3.lab(
    //             parseFloat(data[cell]["L*"]),
    //             parseFloat(data[cell]["a*"]),
    //             parseFloat(data[cell]["b*"])
    //           ),
    //         ],
    //       });
    //     }
    //     console.log("hello");
    //     console.log(color_data);
    //     return color_data;
    //   }

    //   var width = 50;
    //   var height = 50;

    //   var gridData = gridDataFunc(data);
    //   console.log("grid data");
    //   console.log(gridData);

    //   var grid = d3
    //     .select("#grid")
    //     .append("svg")
    //     .attr("width", "510px")
    //     .attr("height", "510px");

    //   function update() {
    //     console.log("beg of update");
    //     for (var i = 0; i < gridData.length; i++) {
    //       var cell = gridData[i];
    //       console.log("cell", cell);
    //       //   cell.color = "#" + Math.floor(Math.random() * 16777215).toString(16);
    //       cell.color = [
    //         d3.lab(
    //           parseFloat(gridData[i]["L*"]),
    //           parseFloat(gridData[i]["a*"]),
    //           parseFloat(gridData[i]["b*"])
    //         ),
    //       ];
    //     }

    //     var cell = grid.selectAll(".cell").data(gridData);

    //     cell
    //       .enter()
    //       .append("rect")
    //       .attr("class", "cell")
    //       .attr("x", function (d) {
    //         return (d.id % 10) * width;
    //       })
    //       .attr("y", function (d) {
    //         return Math.floor(d.id / 10) * height;
    //       })
    //       .attr("width", width)
    //       .attr("height", height)
    //       .style("fill", function (d) {
    //         console.log("color");
    //         console.log(d.color);
    //         return d.color;
    //       })
    //       .style("stroke", "#222");

    //     cell
    //       .transition()
    //       .duration(1500)
    //       .delay(1500)
    //       .style("fill", function (d) {
    //         return d.color;
    //       });
    //   }

    //   console.log("when are we gtting here");
    //   setInterval(update, 5000);

    //**************************************************************************
    //   var square = 20,
    //     w = 900,
    //     h = 300;

    //   // create the svg
    //   var svg = d3.select("#grid").append("svg").attr({
    //     width: w,
    //     height: h,
    //   });

    //   // calculate number of rows and columns
    //   var squaresRow = _.round(w / square);
    //   var squaresColumn = _.round(h / square);

    //   // loop over number of columns
    //   _.times(squaresColumn, function (n) {
    //     // create each set of rows
    //     var rows = svg
    //       .selectAll("rect" + " .row-" + (n + 1))
    //       .data(d3.range(squaresRow))
    //       .enter()
    //       .append("rect")
    //       .attr({
    //         class: function (d, i) {
    //           return "square row-" + (n + 1) + " " + "col-" + (i + 1);
    //         },
    //         id: function (d, i) {
    //           return "s-" + (n + 1) + (i + 1);
    //         },
    //         width: square,
    //         height: square,
    //         x: function (d, i) {
    //           return i * square;
    //         },
    //         y: n * square,
    //         fill: d3.hcl(10.0, 0, 9.5), //"#fff",
    //         stroke: "#FDBB30",
    //       });

    //     // test with some feedback
    //     var test = rows.on("mouseover", function (d, i) {
    //       d3.select("#grid-ref").text(function () {
    //         return "row: " + (n + 1) + " | " + "column: " + (i + 1);
    //       });
    //       d3.selectAll(".square").attr("fill", "white");
    //       d3.select(this).attr("fill", d3.lab(51.57, 35.21, -24.66)); //"#7AC143"
    //     });
    //   });
    //*****************************************************************
    //   var width = 500,
    //     height = 500;

    //   var x = d3.scaleOrdinal().range([20, 200], 0.1);
    //   var y = d3.scaleOrdinal().range([500, 20], 0.1);

    //   var svg = d3
    //     .select("#chart")
    //     .append("svg")
    //     .attr("width", width)
    //     .attr("height", height);

    //   var hue = 0;
    //   var data_color = createData(hue);
    //   console.log("new data");
    //   console.log(data);

    //   svg.call(renderCircles, data_color);

    //   function renderCircles(selection, data) {
    //     var circles = selection.selectAll("circle").data(data);
    //     console.log("new data");
    //     console.log(data);

    //     circles
    //       .enter()
    //       .append("circle")
    //       .attr("cx", function (d) {
    //         return x(d[1]);
    //       })
    //       .attr("cy", function (d) {
    //         return y(d[2]);
    //       })
    //       .attr("r", 20)
    //       .attr("transform", "translate(" + 5 + "," + 5 + ")");

    //     circles.attr("fill", function (d) {
    //       return d3.hcl(d[0], d[1], d[2]).toString();
    //     });
    //   }

    //   function createData(h) {
    //     return d3
    //       .range(-125, 150, 25)
    //       .map(function (c) {
    //         return d3.range(0, 100, 10).map(function (l) {
    //           return [h, c, l];
    //         });
    //       })
    //       .reduce(function (a, b) {
    //         return a.concat(b);
    //       });
    //   }
    // });
    // .catch((e) => {
    //   console.log(e);
    // });
  </script>
</html>
